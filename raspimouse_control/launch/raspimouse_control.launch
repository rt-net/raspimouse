<?xml version="1.0" encoding="UTF-8"?>
<launch>
    <arg name="enable_odom_tf" default="true" />
    <arg name="initial_motor_power" default="on" />
    <arg name="diff_drive_controller" default="diff_drive_controller" />
    <!-- to avoid empty ns problem https://github.com/ros/ros_comm/issues/360 -->
    <arg name="namespace" default="/" />

    <group ns="$(arg namespace)">
        <!-- raspimouse control nodes except motor control -->
        <node name="buzzer" pkg="raspimouse_control" type="buzzer.py" required="true" />
        <node name="lightsensors" pkg="raspimouse_control" type="lightsensors" required="true">
            <param name="frequency" value="10" />
        </node>
        <node name="leds" pkg="raspimouse_control" type="leds" required="true" />
        <node name="buttons" pkg="raspimouse_control" type="buttons" required="true" />

        <!-- raspimouse motor control nodes -->
        <rosparam command="load" file="$(find raspimouse_control)/config/raspimouse_control.yaml" />
        <arg name="tf_namespace" value="" if="$(eval arg('namespace') == '/')" />
        <arg name="tf_namespace" value="$(arg namespace)/" unless="$(eval arg('namespace') == '/')" />
        <rosparam subst_value="true" ns="$(arg diff_drive_controller)">
            enable_odom_tf: $(arg enable_odom_tf)
            base_frame_id: $(arg tf_namespace)base_footprint
            odom_frame_id: $(arg tf_namespace)odom
        </rosparam>
        <node name="controller_spawer" pkg="controller_manager" type="spawner" respawn="false" output="screen" args="$(arg diff_drive_controller) joint_state_controller" />

        <node name="motors" pkg="raspimouse_control" type="motors" required="true"
            output="screen" args="$(arg initial_motor_power)" />
    </group>
</launch>
